2024-05-28 23:12:23.749 | WARNING  | qlib.tests.data:qlib_data:195 - Data already exists: ~/.qlib/qlib_data/cn_data, the data download will be skipped
	If downloading is required: `exists_skip=False` or `change target_dir`
[11739:MainThread](2024-05-28 23:12:23,750) INFO - qlib.Initialization - [config.py:416] - default_conf: client.
[11739:MainThread](2024-05-28 23:12:23,751) INFO - qlib.Initialization - [__init__.py:74] - qlib successfully initialized based on client settings.
[11739:MainThread](2024-05-28 23:12:23,751) INFO - qlib.Initialization - [__init__.py:76] - data_path={'__DEFAULT_FREQ': PosixPath('/Users/boss/.qlib/qlib_data/cn_data')}
[11739:MainThread](2024-05-28 23:12:27,921) INFO - qlib.timer - [log.py:127] - Time cost: 3.625s | Loading data Done
/Users/boss/qlib/.venv/lib/python3.9/site-packages/numpy/lib/nanfunctions.py:1095: RuntimeWarning: All-NaN slice encountered
  result = np.apply_along_axis(_nanmedian1d, axis, a, overwrite_input)
[11739:MainThread](2024-05-28 23:12:28,456) INFO - qlib.timer - [log.py:127] - Time cost: 0.530s | RobustZScoreNorm Done
[11739:MainThread](2024-05-28 23:12:28,487) INFO - qlib.timer - [log.py:127] - Time cost: 0.030s | Fillna Done
[11739:MainThread](2024-05-28 23:12:28,487) INFO - qlib.timer - [log.py:127] - Time cost: 0.566s | fit & process data Done
[11739:MainThread](2024-05-28 23:12:28,487) INFO - qlib.timer - [log.py:127] - Time cost: 4.192s | Init data Done
------------------------
seed: 1
ModuleNotFoundError. CatBoostModel are skipped. (optional: maybe installing CatBoostModel can fix it.)
[11739:MainThread](2024-05-28 23:12:28,609) INFO - qlib.MASTER - [pytorch_master_ts.py:255] - MASTER pytorch version...
[11739:MainThread](2024-05-28 23:12:28,936) INFO - qlib.MASTER - [pytorch_master_ts.py:298] - MASTER parameters setting:
 d_feat : 158
 d_model : 256
 t_nhead : 4
 s_nhead : 2
 n_epochs : 40
 lr : 8e-06
 beta : None
 train_stop_loss_thred : 0.95
 visible_GPU : 0
 seed : 1
[11739:MainThread](2024-05-28 23:12:28,936) INFO - qlib.MASTER - [pytorch_master_ts.py:323] - model:
MASTER(
  (feature_gate): Gate(
    (trans): Linear(in_features=63, out_features=158, bias=True)
  )
  (x2y): Linear(in_features=158, out_features=256, bias=True)
  (pe): PositionalEncoding()
  (tatten): TAttention(
    (qtrans): Linear(in_features=256, out_features=256, bias=False)
    (ktrans): Linear(in_features=256, out_features=256, bias=False)
    (vtrans): Linear(in_features=256, out_features=256, bias=False)
    (attn_dropout): ModuleList(
      (0-3): 4 x Dropout(p=0.5, inplace=False)
    )
    (norm1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
    (norm2): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
    (ffn): Sequential(
      (0): Linear(in_features=256, out_features=256, bias=True)
      (1): ReLU()
      (2): Dropout(p=0.5, inplace=False)
      (3): Linear(in_features=256, out_features=256, bias=True)
      (4): Dropout(p=0.5, inplace=False)
    )
  )
  (satten): SAttention(
    (qtrans): Linear(in_features=256, out_features=256, bias=False)
    (ktrans): Linear(in_features=256, out_features=256, bias=False)
    (vtrans): Linear(in_features=256, out_features=256, bias=False)
    (attn_dropout): ModuleList(
      (0-1): 2 x Dropout(p=0.5, inplace=False)
    )
    (norm1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
    (norm2): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
    (ffn): Sequential(
      (0): Linear(in_features=256, out_features=256, bias=True)
      (1): ReLU()
      (2): Dropout(p=0.5, inplace=False)
      (3): Linear(in_features=256, out_features=256, bias=True)
      (4): Dropout(p=0.5, inplace=False)
    )
  )
  (temporalatten): TemporalAttention(
    (trans): Linear(in_features=256, out_features=256, bias=False)
  )
  (decoder): Linear(in_features=256, out_features=1, bias=True)
)
[11739:MainThread](2024-05-28 23:12:28,936) INFO - qlib.MASTER - [pytorch_master_ts.py:324] - model size: 0.7391 MB
/Users/boss/qlib/.venv/lib/python3.9/site-packages/qlib/contrib/model/pytorch_master_ts.py:231: FutureWarning: The default dtype for empty Series will be 'object' instead of 'float64' in a future version. Specify a dtype explicitly to silence this warning.
  self.daily_count = pd.Series(index=self.data_source.get_index()).groupby("datetime").size().values
[11739:MainThread](2024-05-28 23:13:41,232) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 0, train_loss 1.072311, valid_loss 0.988972 
[11739:MainThread](2024-05-28 23:14:52,808) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 1, train_loss 1.022349, valid_loss 0.979581 
[11739:MainThread](2024-05-28 23:16:05,397) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 2, train_loss 1.001556, valid_loss 0.976733 
[11739:MainThread](2024-05-28 23:17:18,485) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 3, train_loss 0.990239, valid_loss 0.974508 
[11739:MainThread](2024-05-28 23:18:32,280) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 4, train_loss 0.984217, valid_loss 0.973363 
[11739:MainThread](2024-05-28 23:19:53,050) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 5, train_loss 0.977864, valid_loss 0.972366 
[11739:MainThread](2024-05-28 23:21:15,069) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 6, train_loss 0.972876, valid_loss 0.970340 
[11739:MainThread](2024-05-28 23:22:37,330) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 7, train_loss 0.969696, valid_loss 0.968601 
[11739:MainThread](2024-05-28 23:23:58,895) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 8, train_loss 0.966075, valid_loss 0.966005 
[11739:MainThread](2024-05-28 23:25:21,996) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 9, train_loss 0.963148, valid_loss 0.966178 
[11739:MainThread](2024-05-28 23:26:45,639) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 10, train_loss 0.958613, valid_loss 0.961172 
[11739:MainThread](2024-05-28 23:28:10,473) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 11, train_loss 0.954036, valid_loss 0.958744 
[11739:MainThread](2024-05-28 23:29:34,425) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 12, train_loss 0.949364, valid_loss 0.954508 
[11739:MainThread](2024-05-28 23:29:34,427) INFO - qlib.MASTER - [pytorch_master_ts.py:425] - early stop
[11739:MainThread](2024-05-28 23:29:34,428) INFO - qlib.MASTER - [pytorch_master_ts.py:428] - best score: 0.954508 @ 12
[11739:MainThread](2024-05-28 23:29:34,431) INFO - qlib.MASTER - [pytorch_master_ts.py:431] - Save best params to model/csi300master_1.pkl
[11739:MainThread](2024-05-28 23:29:34,444) INFO - qlib.workflow - [exp.py:258] - Experiment 2 starts running ...
[11739:MainThread](2024-05-28 23:29:34,513) INFO - qlib.workflow - [recorder.py:341] - Recorder 43fb88f0dd684580ab446a731f70f691 starts running under Experiment 2 ...
[11739:MainThread](2024-05-28 23:29:34,583) INFO - qlib.MASTER - [pytorch_master_ts.py:339] - model from :model/csi300master_1.pkl
/Users/boss/qlib/.venv/lib/python3.9/site-packages/qlib/contrib/model/pytorch_master_ts.py:231: FutureWarning: The default dtype for empty Series will be 'object' instead of 'float64' in a future version. Specify a dtype explicitly to silence this warning.
  self.daily_count = pd.Series(index=self.data_source.get_index()).groupby("datetime").size().values
[11739:MainThread](2024-05-28 23:29:37,396) INFO - qlib.workflow - [record_temp.py:198] - Signal record 'pred.pkl' has been saved as the artifact of the Experiment 2
'The following are prediction results of the MASTERModel model.'
                              0
datetime   instrument          
2024-01-02 SH600000    0.292071
2024-01-03 SH600000    0.291141
2024-01-04 SH600000    0.282112
2024-01-05 SH600000    0.244741
2024-01-08 SH600000    0.278890
{'IC': 0.16417699734042715,
 'ICIR': 0.7820898247571326,
 'Rank IC': 0.17999877745128331,
 'Rank ICIR': 0.7942034337730284}
[11739:MainThread](2024-05-28 23:29:37,668) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[11739:MainThread](2024-05-28 23:29:42,322) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[11739:MainThread](2024-05-28 23:29:42,322) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[11739:MainThread](2024-05-28 23:29:42,903) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x328a91550>
backtest loop:   0%|          | 0/13 [00:00<?, ?it/s]backtest loop:  92%|█████████▏| 12/13 [00:00<00:00, 115.49it/s]backtest loop: 100%|██████████| 13/13 [00:00<00:00, 116.89it/s]
[11739:MainThread](2024-05-28 23:29:43,035) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1week.pkl' has been saved as the artifact of the Experiment 2
'The following are analysis results of benchmark return(1week).'
                       risk
mean               0.001618
std                0.013192
annualized_return  0.080917
information_ratio  0.867458
max_drawdown      -0.026325
'The following are analysis results of the excess return without cost(1week).'
                       risk
mean               0.008175
std                0.013230
annualized_return  0.408731
information_ratio  4.368960
max_drawdown      -0.022279
'The following are analysis results of the excess return with cost(1week).'
                       risk
mean               0.006709
std                0.013315
annualized_return  0.335458
information_ratio  3.563039
max_drawdown      -0.024052
[11739:MainThread](2024-05-28 23:29:43,040) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1week.pkl' has been saved as the artifact of the Experiment 2
'The following are analysis results of indicators(1week).'
     value
ffr    1.0
pa     0.0
pos    0.0
{'Rank IC': 0.17999877745128331, '1week.excess_return_without_cost.mean': 0.00817462261052179, 'ICIR': 0.7820898247571326, '1week.excess_return_without_cost.std': 0.013230449534932362, 'IC': 0.16417699734042715, '1week.excess_return_without_cost.annualized_return': 0.4087311305260895, 'Rank ICIR': 0.7942034337730284}
[11739:MainThread](2024-05-28 23:29:43,057) INFO - qlib.timer - [log.py:127] - Time cost: 0.006s | waiting `async_log` Done
[11739:MainThread](2024-05-28 23:29:43,059) ERROR - qlib.workflow - [utils.py:41] - An exception has been raised[KeyError: '1week.excess_return_without_cost.information_ratio'].
  File "/Users/boss/qlib/examples/benchmarks/MASTER/main.py", line 104, in <module>
    all_metrics[k].append(metrics[k])
KeyError: '1week.excess_return_without_cost.information_ratio'
