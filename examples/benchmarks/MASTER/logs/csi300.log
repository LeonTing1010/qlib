2024-05-28 19:38:15.526 | WARNING  | qlib.tests.data:qlib_data:195 - Data already exists: ~/.qlib/qlib_data/cn_data, the data download will be skipped
	If downloading is required: `exists_skip=False` or `change target_dir`
[10940:MainThread](2024-05-28 19:38:15,527) INFO - qlib.Initialization - [config.py:416] - default_conf: client.
[10940:MainThread](2024-05-28 19:38:15,528) INFO - qlib.Initialization - [__init__.py:74] - qlib successfully initialized based on client settings.
[10940:MainThread](2024-05-28 19:38:15,528) INFO - qlib.Initialization - [__init__.py:76] - data_path={'__DEFAULT_FREQ': PosixPath('/Users/boss/.qlib/qlib_data/cn_data')}
[10940:MainThread](2024-05-28 19:38:22,195) INFO - qlib.timer - [log.py:127] - Time cost: 5.687s | Loading data Done
/Users/boss/qlib/.venv/lib/python3.9/site-packages/numpy/lib/nanfunctions.py:1095: RuntimeWarning:

All-NaN slice encountered

[10940:MainThread](2024-05-28 19:38:24,481) INFO - qlib.timer - [log.py:127] - Time cost: 2.269s | RobustZScoreNorm Done
[10940:MainThread](2024-05-28 19:38:24,599) INFO - qlib.timer - [log.py:127] - Time cost: 0.118s | Fillna Done
[10940:MainThread](2024-05-28 19:38:24,599) INFO - qlib.timer - [log.py:127] - Time cost: 2.404s | fit & process data Done
[10940:MainThread](2024-05-28 19:38:24,600) INFO - qlib.timer - [log.py:127] - Time cost: 8.092s | Init data Done
------------------------
seed: 1
ModuleNotFoundError. CatBoostModel are skipped. (optional: maybe installing CatBoostModel can fix it.)
[10940:MainThread](2024-05-28 19:38:24,716) INFO - qlib.MASTER - [pytorch_master_ts.py:255] - MASTER pytorch version...
[10940:MainThread](2024-05-28 19:38:25,077) INFO - qlib.MASTER - [pytorch_master_ts.py:298] - MASTER parameters setting:
 d_feat : 158
 d_model : 256
 t_nhead : 4
 s_nhead : 2
 n_epochs : 40
 lr : 8e-06
 beta : None
 train_stop_loss_thred : 0.95
 visible_GPU : 0
 seed : 1
[10940:MainThread](2024-05-28 19:38:25,077) INFO - qlib.MASTER - [pytorch_master_ts.py:323] - model:
MASTER(
  (feature_gate): Gate(
    (trans): Linear(in_features=63, out_features=158, bias=True)
  )
  (x2y): Linear(in_features=158, out_features=256, bias=True)
  (pe): PositionalEncoding()
  (tatten): TAttention(
    (qtrans): Linear(in_features=256, out_features=256, bias=False)
    (ktrans): Linear(in_features=256, out_features=256, bias=False)
    (vtrans): Linear(in_features=256, out_features=256, bias=False)
    (attn_dropout): ModuleList(
      (0-3): 4 x Dropout(p=0.5, inplace=False)
    )
    (norm1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
    (norm2): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
    (ffn): Sequential(
      (0): Linear(in_features=256, out_features=256, bias=True)
      (1): ReLU()
      (2): Dropout(p=0.5, inplace=False)
      (3): Linear(in_features=256, out_features=256, bias=True)
      (4): Dropout(p=0.5, inplace=False)
    )
  )
  (satten): SAttention(
    (qtrans): Linear(in_features=256, out_features=256, bias=False)
    (ktrans): Linear(in_features=256, out_features=256, bias=False)
    (vtrans): Linear(in_features=256, out_features=256, bias=False)
    (attn_dropout): ModuleList(
      (0-1): 2 x Dropout(p=0.5, inplace=False)
    )
    (norm1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
    (norm2): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
    (ffn): Sequential(
      (0): Linear(in_features=256, out_features=256, bias=True)
      (1): ReLU()
      (2): Dropout(p=0.5, inplace=False)
      (3): Linear(in_features=256, out_features=256, bias=True)
      (4): Dropout(p=0.5, inplace=False)
    )
  )
  (temporalatten): TemporalAttention(
    (trans): Linear(in_features=256, out_features=256, bias=False)
  )
  (decoder): Linear(in_features=256, out_features=1, bias=True)
)
[10940:MainThread](2024-05-28 19:38:25,078) INFO - qlib.MASTER - [pytorch_master_ts.py:324] - model size: 0.7391 MB
/Users/boss/qlib/.venv/lib/python3.9/site-packages/qlib/contrib/model/pytorch_master_ts.py:231: FutureWarning:

The default dtype for empty Series will be 'object' instead of 'float64' in a future version. Specify a dtype explicitly to silence this warning.

[10940:MainThread](2024-05-28 19:48:51,612) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 0, train_loss 1.022647, valid_loss 0.977737 
[10940:MainThread](2024-05-28 19:59:17,712) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 1, train_loss 0.981080, valid_loss 0.970655 
[10940:MainThread](2024-05-28 20:09:47,371) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 2, train_loss 0.971097, valid_loss 0.967729 
[10940:MainThread](2024-05-28 20:20:14,061) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 3, train_loss 0.960795, valid_loss 0.954933 
[10940:MainThread](2024-05-28 20:30:44,530) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 4, train_loss 0.943632, valid_loss 0.924092 
[10940:MainThread](2024-05-28 20:30:44,533) INFO - qlib.MASTER - [pytorch_master_ts.py:425] - early stop
[10940:MainThread](2024-05-28 20:30:44,534) INFO - qlib.MASTER - [pytorch_master_ts.py:428] - best score: 0.924092 @ 4
[10940:MainThread](2024-05-28 20:30:44,537) INFO - qlib.MASTER - [pytorch_master_ts.py:431] - Save best params to model/csi300master_1.pkl
[10940:MainThread](2024-05-28 20:30:44,583) INFO - qlib.workflow - [exp.py:258] - Experiment 2 starts running ...
[10940:MainThread](2024-05-28 20:30:44,663) INFO - qlib.workflow - [recorder.py:341] - Recorder ccc7325b7a4044ff8d6c5c96d881891a starts running under Experiment 2 ...
[10940:MainThread](2024-05-28 20:30:44,747) INFO - qlib.MASTER - [pytorch_master_ts.py:339] - model from :model/csi300master_1.pkl
/Users/boss/qlib/.venv/lib/python3.9/site-packages/qlib/contrib/model/pytorch_master_ts.py:231: FutureWarning:

The default dtype for empty Series will be 'object' instead of 'float64' in a future version. Specify a dtype explicitly to silence this warning.

[10940:MainThread](2024-05-28 20:30:49,478) INFO - qlib.workflow - [record_temp.py:198] - Signal record 'pred.pkl' has been saved as the artifact of the Experiment 2
'The following are prediction results of the MASTERModel model.'
                              0
datetime   instrument          
2024-01-02 SH600000    0.188354
2024-01-03 SH600000    0.197200
2024-01-04 SH600000    0.211545
2024-01-05 SH600000    0.188018
2024-01-08 SH600000    0.218334
{'IC': 0.27822137349754994,
 'ICIR': 2.526749512450653,
 'Rank IC': 0.28577847167623455,
 'Rank ICIR': 2.6752578066173265}
[10940:MainThread](2024-05-28 20:30:49,756) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[10940:MainThread](2024-05-28 20:30:54,998) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[10940:MainThread](2024-05-28 20:30:54,999) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[10940:MainThread](2024-05-28 20:30:55,576) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x2989b2df0>
backtest loop:   0%|          | 0/13 [00:00<?, ?it/s]backtest loop:  62%|██████▏   | 8/13 [00:00<00:00, 73.20it/s]backtest loop: 100%|██████████| 13/13 [00:00<00:00, 73.15it/s]
[10940:MainThread](2024-05-28 20:30:55,775) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1week.pkl' has been saved as the artifact of the Experiment 2
'The following are analysis results of benchmark return(1week).'
                       risk
mean               0.001618
std                0.013192
annualized_return  0.080917
information_ratio  0.867458
max_drawdown      -0.026325
'The following are analysis results of the excess return without cost(1week).'
                       risk
mean               0.012222
std                0.010349
annualized_return  0.611122
information_ratio  8.350792
max_drawdown      -0.000050
'The following are analysis results of the excess return with cost(1week).'
                       risk
mean               0.009978
std                0.010317
annualized_return  0.498888
information_ratio  6.838704
max_drawdown      -0.002003
[10940:MainThread](2024-05-28 20:30:55,779) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1week.pkl' has been saved as the artifact of the Experiment 2
'The following are analysis results of indicators(1week).'
     value
ffr    1.0
pa     0.0
pos    0.0
{'Rank IC': 0.28577847167623455, '1week.excess_return_without_cost.mean': 0.012222439814475152, 'ICIR': 2.526749512450653, '1week.excess_return_without_cost.std': 0.010349402276731657, 'IC': 0.27822137349754994, '1week.excess_return_without_cost.annualized_return': 0.6111219907237576, 'Rank ICIR': 2.6752578066173265}
[10940:MainThread](2024-05-28 20:30:55,801) INFO - qlib.timer - [log.py:127] - Time cost: 0.006s | waiting `async_log` Done
[10940:MainThread](2024-05-28 20:30:55,803) ERROR - qlib.workflow - [utils.py:41] - An exception has been raised[KeyError: '1week.excess_return_without_cost.information_ratio'].
  File "/Users/boss/qlib/examples/benchmarks/MASTER/main.py", line 107, in <module>
    all_metrics[k].append(metrics[k])
KeyError: '1week.excess_return_without_cost.information_ratio'
