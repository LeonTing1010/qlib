2024-05-28 21:36:50.569 | WARNING  | qlib.tests.data:qlib_data:195 - Data already exists: ~/.qlib/qlib_data/cn_data, the data download will be skipped
	If downloading is required: `exists_skip=False` or `change target_dir`
[11593:MainThread](2024-05-28 21:36:50,569) INFO - qlib.Initialization - [config.py:416] - default_conf: client.
[11593:MainThread](2024-05-28 21:36:50,571) INFO - qlib.Initialization - [__init__.py:74] - qlib successfully initialized based on client settings.
[11593:MainThread](2024-05-28 21:36:50,571) INFO - qlib.Initialization - [__init__.py:76] - data_path={'__DEFAULT_FREQ': PosixPath('/Users/boss/.qlib/qlib_data/cn_data')}
[11593:MainThread](2024-05-28 21:36:54,757) INFO - qlib.timer - [log.py:127] - Time cost: 3.634s | Loading data Done
/Users/boss/qlib/.venv/lib/python3.9/site-packages/numpy/lib/nanfunctions.py:1095: RuntimeWarning: All-NaN slice encountered
  result = np.apply_along_axis(_nanmedian1d, axis, a, overwrite_input)
[11593:MainThread](2024-05-28 21:36:55,302) INFO - qlib.timer - [log.py:127] - Time cost: 0.541s | RobustZScoreNorm Done
[11593:MainThread](2024-05-28 21:36:55,334) INFO - qlib.timer - [log.py:127] - Time cost: 0.031s | Fillna Done
[11593:MainThread](2024-05-28 21:36:55,334) INFO - qlib.timer - [log.py:127] - Time cost: 0.577s | fit & process data Done
[11593:MainThread](2024-05-28 21:36:55,334) INFO - qlib.timer - [log.py:127] - Time cost: 4.211s | Init data Done
------------------------
seed: 1
ModuleNotFoundError. CatBoostModel are skipped. (optional: maybe installing CatBoostModel can fix it.)
[11593:MainThread](2024-05-28 21:36:55,455) INFO - qlib.MASTER - [pytorch_master_ts.py:255] - MASTER pytorch version...
[11593:MainThread](2024-05-28 21:36:55,789) INFO - qlib.MASTER - [pytorch_master_ts.py:298] - MASTER parameters setting:
 d_feat : 158
 d_model : 256
 t_nhead : 4
 s_nhead : 2
 n_epochs : 40
 lr : 8e-06
 beta : None
 train_stop_loss_thred : 0.95
 visible_GPU : 0
 seed : 1
[11593:MainThread](2024-05-28 21:36:55,789) INFO - qlib.MASTER - [pytorch_master_ts.py:323] - model:
MASTER(
  (feature_gate): Gate(
    (trans): Linear(in_features=63, out_features=158, bias=True)
  )
  (x2y): Linear(in_features=158, out_features=256, bias=True)
  (pe): PositionalEncoding()
  (tatten): TAttention(
    (qtrans): Linear(in_features=256, out_features=256, bias=False)
    (ktrans): Linear(in_features=256, out_features=256, bias=False)
    (vtrans): Linear(in_features=256, out_features=256, bias=False)
    (attn_dropout): ModuleList(
      (0-3): 4 x Dropout(p=0.5, inplace=False)
    )
    (norm1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
    (norm2): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
    (ffn): Sequential(
      (0): Linear(in_features=256, out_features=256, bias=True)
      (1): ReLU()
      (2): Dropout(p=0.5, inplace=False)
      (3): Linear(in_features=256, out_features=256, bias=True)
      (4): Dropout(p=0.5, inplace=False)
    )
  )
  (satten): SAttention(
    (qtrans): Linear(in_features=256, out_features=256, bias=False)
    (ktrans): Linear(in_features=256, out_features=256, bias=False)
    (vtrans): Linear(in_features=256, out_features=256, bias=False)
    (attn_dropout): ModuleList(
      (0-1): 2 x Dropout(p=0.5, inplace=False)
    )
    (norm1): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
    (norm2): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
    (ffn): Sequential(
      (0): Linear(in_features=256, out_features=256, bias=True)
      (1): ReLU()
      (2): Dropout(p=0.5, inplace=False)
      (3): Linear(in_features=256, out_features=256, bias=True)
      (4): Dropout(p=0.5, inplace=False)
    )
  )
  (temporalatten): TemporalAttention(
    (trans): Linear(in_features=256, out_features=256, bias=False)
  )
  (decoder): Linear(in_features=256, out_features=1, bias=True)
)
[11593:MainThread](2024-05-28 21:36:55,789) INFO - qlib.MASTER - [pytorch_master_ts.py:324] - model size: 0.7391 MB
/Users/boss/qlib/.venv/lib/python3.9/site-packages/qlib/contrib/model/pytorch_master_ts.py:231: FutureWarning: The default dtype for empty Series will be 'object' instead of 'float64' in a future version. Specify a dtype explicitly to silence this warning.
  self.daily_count = pd.Series(index=self.data_source.get_index()).groupby("datetime").size().values
[11593:MainThread](2024-05-28 21:39:12,625) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 0, train_loss 1.076935, valid_loss 0.987342 
[11593:MainThread](2024-05-28 21:41:28,754) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 1, train_loss 1.020733, valid_loss 0.978570 
[11593:MainThread](2024-05-28 21:43:45,141) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 2, train_loss 1.001854, valid_loss 0.977665 
[11593:MainThread](2024-05-28 21:46:01,662) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 3, train_loss 0.989641, valid_loss 0.975367 
[11593:MainThread](2024-05-28 21:48:18,117) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 4, train_loss 0.981822, valid_loss 0.971508 
[11593:MainThread](2024-05-28 21:50:35,281) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 5, train_loss 0.976156, valid_loss 0.971893 
[11593:MainThread](2024-05-28 21:52:52,328) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 6, train_loss 0.971380, valid_loss 0.970748 
[11593:MainThread](2024-05-28 21:55:09,924) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 7, train_loss 0.967132, valid_loss 0.967883 
[11593:MainThread](2024-05-28 21:57:27,397) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 8, train_loss 0.963722, valid_loss 0.964589 
[11593:MainThread](2024-05-28 21:59:42,853) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 9, train_loss 0.959746, valid_loss 0.964104 
[11593:MainThread](2024-05-28 22:01:58,880) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 10, train_loss 0.955067, valid_loss 0.960380 
[11593:MainThread](2024-05-28 22:04:14,411) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 11, train_loss 0.950746, valid_loss 0.959877 
[11593:MainThread](2024-05-28 22:06:34,728) INFO - qlib.MASTER - [pytorch_master_ts.py:419] - Epoch 12, train_loss 0.944682, valid_loss 0.955533 
[11593:MainThread](2024-05-28 22:06:34,730) INFO - qlib.MASTER - [pytorch_master_ts.py:425] - early stop
[11593:MainThread](2024-05-28 22:06:34,731) INFO - qlib.MASTER - [pytorch_master_ts.py:428] - best score: 0.955533 @ 12
[11593:MainThread](2024-05-28 22:06:34,734) INFO - qlib.MASTER - [pytorch_master_ts.py:431] - Save best params to model/csi300master_1.pkl
[11593:MainThread](2024-05-28 22:06:34,751) INFO - qlib.workflow - [exp.py:258] - Experiment 2 starts running ...
[11593:MainThread](2024-05-28 22:06:34,820) INFO - qlib.workflow - [recorder.py:341] - Recorder dc812c170c9a40e4b0e43dce82b42a31 starts running under Experiment 2 ...
[11593:MainThread](2024-05-28 22:06:34,890) INFO - qlib.MASTER - [pytorch_master_ts.py:339] - model from :model/csi300master_1.pkl
/Users/boss/qlib/.venv/lib/python3.9/site-packages/qlib/contrib/model/pytorch_master_ts.py:231: FutureWarning: The default dtype for empty Series will be 'object' instead of 'float64' in a future version. Specify a dtype explicitly to silence this warning.
  self.daily_count = pd.Series(index=self.data_source.get_index()).groupby("datetime").size().values
[11593:MainThread](2024-05-28 22:06:39,459) INFO - qlib.workflow - [record_temp.py:198] - Signal record 'pred.pkl' has been saved as the artifact of the Experiment 2
'The following are prediction results of the MASTERModel model.'
                              0
datetime   instrument          
2024-01-02 SH600000    0.353356
2024-01-03 SH600000    0.337586
2024-01-04 SH600000    0.276474
2024-01-05 SH600000    0.306603
2024-01-08 SH600000    0.245701
{'IC': 0.167369501623787,
 'ICIR': 0.9183364148955386,
 'Rank IC': 0.18237246509450084,
 'Rank ICIR': 0.9155701356019318}
[11593:MainThread](2024-05-28 22:06:39,614) INFO - qlib.backtest caller - [__init__.py:93] - Create new exchange
[11593:MainThread](2024-05-28 22:06:44,360) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[11593:MainThread](2024-05-28 22:06:44,361) WARNING - qlib.online operator - [exchange.py:219] - $close field data contains nan.
[11593:MainThread](2024-05-28 22:06:44,946) WARNING - qlib.BaseExecutor - [executor.py:121] - `common_infra` is not set for <qlib.backtest.executor.SimulatorExecutor object at 0x32a69d190>
backtest loop:   0%|          | 0/13 [00:00<?, ?it/s]backtest loop:  92%|█████████▏| 12/13 [00:00<00:00, 115.46it/s]backtest loop: 100%|██████████| 13/13 [00:00<00:00, 115.71it/s]
[11593:MainThread](2024-05-28 22:06:45,080) INFO - qlib.workflow - [record_temp.py:515] - Portfolio analysis record 'port_analysis_1week.pkl' has been saved as the artifact of the Experiment 2
'The following are analysis results of benchmark return(1week).'
                       risk
mean               0.001618
std                0.013192
annualized_return  0.080917
information_ratio  0.867458
max_drawdown      -0.026325
'The following are analysis results of the excess return without cost(1week).'
                       risk
mean               0.007982
std                0.013318
annualized_return  0.399077
information_ratio  4.237665
max_drawdown      -0.017327
'The following are analysis results of the excess return with cost(1week).'
                       risk
mean               0.006496
std                0.013369
annualized_return  0.324811
information_ratio  3.435822
max_drawdown      -0.019288
[11593:MainThread](2024-05-28 22:06:45,084) INFO - qlib.workflow - [record_temp.py:540] - Indicator analysis record 'indicator_analysis_1week.pkl' has been saved as the artifact of the Experiment 2
'The following are analysis results of indicators(1week).'
     value
ffr    1.0
pa     0.0
pos    0.0
{'Rank IC': 0.18237246509450084, '1week.excess_return_without_cost.mean': 0.007981544845344418, 'ICIR': 0.9183364148955386, '1week.excess_return_without_cost.std': 0.013318193201725479, 'IC': 0.167369501623787, '1week.excess_return_without_cost.annualized_return': 0.3990772422672209, 'Rank ICIR': 0.9155701356019318}
[11593:MainThread](2024-05-28 22:06:45,102) INFO - qlib.timer - [log.py:127] - Time cost: 0.006s | waiting `async_log` Done
[11593:MainThread](2024-05-28 22:06:45,103) ERROR - qlib.workflow - [utils.py:41] - An exception has been raised[KeyError: '1week.excess_return_without_cost.information_ratio'].
  File "/Users/boss/qlib/examples/benchmarks/MASTER/main.py", line 104, in <module>
    all_metrics[k].append(metrics[k])
KeyError: '1week.excess_return_without_cost.information_ratio'
